name: webapp

targets:
  install_node_dependencies:
    input:
      - paths: [package.json, yarn.lock]
    output:
      - paths: [node_modules]
    build: yarn install

  build:
    dependencies: [install_node_dependencies]
    input:
      - paths: [package.json, node_modules, src, public]
    output:
      - paths: [build]
    build: yarn build

  run:
    dependencies: [install_node_dependencies]
    input:
      - paths: [.]
    service: exec yarn start

  docker_build:
    dependencies: [build]
    input:
      - paths: [Dockerfile, build]
    output:
      - cmd_stdout: docker image ls todos/webapp:latest --format "{{.ID}}"
    build: docker build -t todos/webapp .
