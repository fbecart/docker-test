name: backend

targets:
  install_node_dependencies:
    input:
      - paths: [package.json, yarn.lock]
    output:
      - paths: [node_modules]
    build: yarn install

  run:
    dependencies: [install_node_dependencies]
    input:
      - paths: [.]
    service: exec node index.js

  docker_build:
    input:
      - paths: [.]
    output:
      - cmd_stdout: 'docker image ls todos/backend:latest --format "{{.ID}}"'
    build: docker build -t todos/backend .
